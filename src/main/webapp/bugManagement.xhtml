<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<f:view>
    <h:head>
        <h:outputStylesheet library="css" name="styles.css"/>
    </h:head>
    <h:body>
        <h:form>
            <p:panel>
                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton value="Home" action="homepage" styleClass="aButton"/>
                        <p:selectOneMenu id="selectOneMenuUser" value="#{userEditBean.outcome}" ajax="false">
                            <f:selectItem itemLabel="User Management"/>
                            <f:selectItem itemValue="editUser" itemLabel="Edit User"/>
                            <f:selectItem itemValue="register" itemLabel="Add User"/>
                            <p:ajax event="change" listener="#{userEditBean.navigate()}"/>
                        </p:selectOneMenu>
                        <p:selectOneMenu id="selectOneMenuBug" value="#{userEditBean.outcome}" ajax="false">
                            <f:selectItem itemLabel="Bug Management"/>
                            <f:selectItem itemValue="bugManagement" itemLabel="Edit bug"/>
                            <f:selectItem itemValue="AddBug" itemLabel="Add bug"/>
                            <p:ajax event="change" listener="#{userEditBean.navigate()}"/>
                        </p:selectOneMenu>
                        <p:commandButton value="Account" action="account" styleClass="aButton"/>
                    </p:toolbarGroup>
                    <p:toolbarGroup align="right">
                        <p:commandButton value="Logout" action="#{userEditBean.logout}"
                                         ajax="false"
                                         styleClass="aButton"/>
                    </p:toolbarGroup>
                    <br/>
                </p:toolbar>
            </p:panel>
        </h:form>

        <h:form id="datatableform">
            <p:dataTable id="table" value="#{bugBean}" var="bug"
                         selection="#{bugBean.selectedBugs}" rowKey="#{bug.id}" paginator="true" rows="25"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         lazy="true" editable="true" editMode="cell" cellEditMode="lazy" paginatorPosition="bottom">
                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                <p:ajax event="rowSelect" listener="#{bugBean.rowSelected}"/>


                <p:column sortBy="#{bug.id-1}" filterBy="#{bug.id-1}" filterMatchMode="contains">
                    <f:facet name="header">Id</f:facet>
                    #{bug.id-1}
                </p:column>

                <p:column id="titleColumn" sortBy="#{bug.title}" filterBy="#{bug.title}" filterMatchMode="contains">
                    <f:facet name="header">Title</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.title}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{bugBean.title}" style="width:96%" required="true" render="@all"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column sortBy="#{bug.description}" filterBy="#{bug.description}" filterMatchMode="contains">
                    <f:facet name="header">Description</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.description}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{bugBean.description}" style="width:96%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column sortBy="#{bug.version}" filterBy="#{bug.version}" filterMatchMode="contains">
                    <f:facet name="header">Version</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.version}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{bugBean.version}" style="width:96%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column sortBy="#{bug.fixedInVersion}" filterBy="#{bug.fixedInVersion}" filterMatchMode="contains">
                    <f:facet name="header">Fixed in version</f:facet>
                    #{bug.fixedInVersion}
                </p:column>
                <p:column sortBy="#{bug.targetDate}" filterBy="#{bug.targetDate}" filterMatchMode="contains">
                    <f:facet name="header">Target date</f:facet>
                    #{bug.targetDate}
                </p:column>
                <p:column sortBy="#{bug.severityType}" filterBy="#{bug.severityType}" filterMatchMode="contains">
                    <f:facet name="header">Severity type</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.severityType}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu id="severityMenu" effect="fade" value="#{bugBean.severityType}" style="width:125px">
                                <f:selectItem itemLabel="CRITICAL" itemValue="CRITICAL"/>
                                <f:selectItem itemLabel="HIGH" itemValue="HIGH"/>
                                <f:selectItem itemLabel="MEDIUM" itemValue="MEDIUM"/>
                                <f:selectItem itemLabel="LOW" itemValue="LOW"/>
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column sortBy="#{bug.createdBy}" filterBy="#{bug.createdBy}" filterMatchMode="contains">
                    <f:facet name="header">Created by</f:facet>
                    #{bug.createdBy}
                </p:column>
                <p:column sortBy="#{bug.statusType}" filterBy="#{bug.statusType}" filterMatchMode="contains">
                    <f:facet name="header">Status type</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.statusType}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:growl id="statusType" showDetail="false"/>
                            <c:if test="#{(bugBean.selectedBugs.get(0).statusType eq 'NEW' or bugBean.selectedBugs.get(0).statusType eq null)}">
                                <p:selectOneMenu id="statusMenu1" effect="fade" value="#{bugBean.statusType}" style="width:125px">
                                    <f:selectItem itemLabel="Choose type" itemDisabled="true"/>
                                    <f:selectItem itemLabel="IN_PROGRESS" itemValue="IN_PROGRESS"/>
                                    <f:selectItem itemLabel="REJECTED" itemValue="REJECTED"/>
                                </p:selectOneMenu>
                            </c:if>
                            <c:if test="#{bugBean.selectedBugs.get(0).statusType eq 'REJECTED'}">
                                <p:selectOneMenu id="statusMenu2" effect="fade" value="#{bugBean.statusType}" style="width:125px">
                                    <f:selectItem itemLabel="Choose type" itemDisabled="true"/>
                                    <f:selectItem itemLabel="CLOSED" itemValue="CLOSED"/>
                                </p:selectOneMenu>
                            </c:if>
                            <c:if test="#{bugBean.selectedBugs.get(0).statusType eq 'INFO_NEEDED'}">
                                <p:selectOneMenu id="statusMenu3" effect="fade" value="#{bugBean.statusType}" style="width:125px">
                                    <f:selectItem itemLabel="Choose type" itemDisabled="true"/>
                                    <f:selectItem itemLabel="IN_PROGRESS" itemValue="IN_PROGRESS"/>
                                </p:selectOneMenu>
                            </c:if>
                            <c:if test="#{bugBean.selectedBugs.get(0).statusType eq 'IN_PROGRESS'}">
                                <p:selectOneMenu id="statusMenu4" effect="fade" value="#{bugBean.statusType}" style="width:125px">
                                    <f:selectItem itemLabel="Choose type" itemDisabled="true"/>
                                    <f:selectItem itemLabel="FIXED" itemValue="FIXED"/>
                                    <f:selectItem itemLabel="REJECTED" itemValue="REJECTED"/>
                                    <f:selectItem itemLabel="INFO_NEEDED" itemValue="INFO_NEEDED"/>
                                </p:selectOneMenu>
                            </c:if>
                            <c:if test="#{bugBean.selectedBugs.get(0).statusType eq 'FIXED'}">
                                <p:selectOneMenu id="statusMenu5" effect="fade" value="#{bugBean.statusType}" style="width:125px">
                                    <f:selectItem itemLabel="Choose type" itemDisabled="true"/>
                                    <f:selectItem itemLabel="NEW" itemValue="NEW"/>
                                    <f:selectItem itemLabel="CLOSED" itemValue="CLOSED"/>
                                </p:selectOneMenu>
                            </c:if>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:column sortBy="#{bug.assignedTo}" filterBy="#{bug.assignedTo}" filterMatchMode="contains">
                    <f:facet name="header">Assigned to</f:facet>
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{bug.assignedTo}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{bugBean.assignedTo}" style="width:96%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
                <p:ajax event="cellEdit" listener="#{bugBean.updateBug}" update=":datatableform:table"/>


                <p:column sortBy="#{bug.notification}" filterBy="#{bug.notification}" filterMatchMode="contains">
                    <f:facet name="header">Notification</f:facet>
                    #{bug.notification}
                </p:column>
                <p:column>
                    <f:facet name="header">Attachment</f:facet>

                    <p:commandButton value="Download attachment" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
                        <p:fileDownload value="#{bugBean.downloadAttachment()}" />
                    </p:commandButton>
                    <p:commandButton value="Download bug" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
                        <p:fileDownload value="#{bugBean.getPDF()}" />
                    </p:commandButton>
                    <h:commandButton value="Delete attachment" action="#{bugBean.deleteAttachment}" ajax="true"/>

                    <p:fileUpload fileUploadListener="#{bugBean.handleFileUpload}" mode="advanced"
                                  dragDropSupport="false"
                                  update="messages" auto="true" sizeLimit="26214400" fileLimit="1"
                                  allowTypes="/(\.|\/)(gif|jpe?g|png|pdf|xlsx|xls|doc|odf)$/"/>
                    <p:growl id="messages" showDetail="true"/>
                </p:column>

                <br/>
                <p:rowEditor/>
            </p:dataTable>
            <br/>

        </h:form>

        <h:form id="form">
            <div align="left">
                <p:commandButton value="Download excel" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthick-1-s">
                    <p:fileDownload value="#{bugBean.getExcel()}" />
                </p:commandButton>
            </div>
            <h:commandButton value="Back" action="homepage" ajax="false"/>
            <h:commandButton value="Add bug" action="AddBug" ajax="false"/>
        </h:form>
    </h:body>
</f:view>
</html>